<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Ficha D&D 5e</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-paper: #f9f5e6;
      --bg-dark: #e8dfc5;
      --ink-color: #2b2118;
      --accent-color: #8b4513;
      --border-color: #5c4a3d;
      --font-title: 'Cinzel', serif;
      --font-body: 'Crimson Text', serif;
    }

    * { box-sizing: border-box; }

    body {
      font-family: var(--font-body);
      background: #333;
      margin: 0;
      padding: 30px;
      color: var(--ink-color);
    }

    form.charsheet {
      width: 850px;
      margin: 0 auto;
      background-color: var(--bg-paper);
      padding: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      border: 1px solid #dcdcdc;
    }

    input, textarea {
      font-family: var(--font-body);
      color: var(--ink-color);
      background: transparent;
    }

    textarea {
      font-size: 14px;
      text-align: left;
      width: 100%;
      border-radius: 5px;
      padding: 5px;
      resize: none;
      overflow: hidden;
      border: 1px solid rgba(92, 74, 61, 0.3);
      line-height: 1.4;
    }
    
    input[type=checkbox] { cursor: pointer; }

    label {
      text-transform: uppercase;
      font-family: var(--font-title);
      font-size: 10px;
      letter-spacing: 0.5px;
      color: var(--accent-color);
    }

    ul { margin: 0; padding: 0; list-style: none; }

    form.charsheet header {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      align-items: stretch;
    }

    form.charsheet header section.charname {
      border: 3px double var(--border-color);
      border-radius: 10px;
      padding: 0px;
      background-color: var(--bg-dark);
      width: 35%;
      display: flex;
      flex-direction: column-reverse;
      justify-content: center;
    }

    form.charsheet header section.charname input {
      padding: 5px;
      margin-bottom: 2px;
      border: 0;
      border-bottom: 2px solid var(--border-color);
      width: 100%;
      text-align: center;
      font-size: 26px;
      font-weight: 700;
      font-family: var(--font-title);
    }

    form.charsheet header section.charname label {
      width: 100%;
      text-align: center;
      font-size: 11px;
    }

    form.charsheet header section.misc {
      width: 65%;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      padding: 10px;
    }

    form.charsheet header section.misc ul {
      display: flex;
      flex-wrap: wrap;
      height: 100%;
    }

    form.charsheet header section.misc ul li {
      width: 33.33%;
      display: flex;
      flex-direction: column-reverse;
      padding: 5px 10px;
      border-right: 1px solid rgba(92, 74, 61, 0.2);
    }
    
    form.charsheet header section.misc ul li:nth-child(3n) { border-right: none; }

    form.charsheet header section.misc ul li input {
      border: 0;
      border-bottom: 1px solid var(--border-color);
      width: 100%;
      font-size: 14px;
    }

    form.charsheet header section.misc ul li label {
      font-size: 9px;
      font-weight: bold;
    }

    form.charsheet main {
      display: flex;
      justify-content: space-between;
      gap: 15px;
      min-height: 800px;
    }

    form.charsheet main > section {
      width: 32%;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    form.charsheet .attributes {
      display: flex;
      justify-content: space-between;
      gap: 5px;
    }

    form.charsheet .scores {
      width: 90px;
      background-color: var(--bg-dark);
      border-radius: 20px;
      padding: 10px 5px;
      text-align: center;
      border: 1px solid var(--border-color);
    }

    form.charsheet .scores ul {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    form.charsheet .scores li {
      background: var(--bg-paper);
      border: 2px solid var(--border-color);
      border-radius: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-bottom: 15px;
      position: relative;
    }

    form.charsheet .scores .score label {
      font-size: 8px;
      font-weight: bold;
      padding-top: 5px;
      margin-bottom: 0;
      color: var(--ink-color);
      display: block;
      letter-spacing: 1px;
    }

    form.charsheet .scores .score input {
      border: 0;
      text-align: center;
      font-size: 14px;
      width: 100%;
      padding: 0;
      color: #666;
      background: transparent;
    }

    form.charsheet .scores .modifier {
      position: absolute;
      bottom: -14px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
    }

    form.charsheet .scores .modifier input {
      width: 50px;
      height: 30px;
      border: 2px solid var(--border-color);
      border-radius: 15px;
      text-align: center;
      background: white;
      font-weight: bold;
      font-size: 18px;
      color: black;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 10;
    }

    form.charsheet .attr-applications {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .list-section {
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 2px 1px;
      background: white;
    }

    .list-section .label {
      text-align: center;
      font-weight: bold;
      font-size: 10px;
      margin-top: 2px;
      font-family: var(--font-title);
      border-top: 1px solid #ccc;
      padding-top: 2px;
    }

    .list-section ul li {
      display: flex;
      align-items: center;
      margin-bottom: 1px;
      font-size: 11px;
      line-height: 1.1;
    }

    .list-section input[type=checkbox] {
      -webkit-appearance: none; appearance: none;
      width: 9px; height: 9px;
      border: 1px solid var(--border-color);
      border-radius: 50%;
      margin-right: 5px;
      position: relative;
    }

    .list-section input[type=checkbox]:checked {
      background-color: var(--ink-color);
      box-shadow: inset 0 0 0 1.5px white;
    }

    .list-section input[type=text] {
      width: 20px;
      border: 0;
      border-bottom: 1px solid #ccc;
      text-align: center;
      margin-right: 4px;
      font-size: 11px;
    }

    .list-section label {
      text-transform: none;
      color: var(--ink-color);
      font-size: 11px;
      font-family: var(--font-body);
      white-space: nowrap;
    }

    .list-section label span.skill {
      color: #888;
      font-size: 9px;
      font-style: italic;
      margin-left: 2px;
    }
    
    .inspiration, .proficiencybonus {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 5px;
    }

    .inspiration input, .proficiencybonus input {
      width: 45px; height: 45px;
      border: 2px solid var(--border-color);
      border-radius: 5px;
      text-align: center;
      font-size: 20px;
      background: white;
    }
    
    .inspiration input[type=checkbox] { border-radius: 5px; }
    .inspiration input[type=checkbox]:checked { background: var(--ink-color); }

    .inspiration .label-container, .proficiencybonus .label-container {
      flex: 1;
      border: 1px solid var(--border-color);
      border-radius: 5px;
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 5px;
    }

    .passive-perception {
      display: flex;
      align-items: center;
      gap: 10px;
      border: 1px solid var(--border-color);
      padding: 5px;
      border-radius: 20px;
      background: white;
    }
    .passive-perception .label-container { flex: 1; text-align: left; }
    .passive-perception input {
      width: 30px; border: 0; font-weight: bold; font-size: 16px; text-align: center;
    }

    .otherprofs {
      border: 2px solid var(--border-color);
      border-radius: 10px;
      padding: 8px;
      display: flex;
      flex-direction: column-reverse;
      flex-grow: 1;
      background: white;
    }
    .otherprofs label { text-align: center; font-weight: bold; margin-top: 5px; }
    .otherprofs textarea { border: 0; flex: 1; height: 100%; font-size: 13px; }

    .combat {
      background: var(--bg-dark);
      border-radius: 10px;
      padding: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 1%;
    }

    .combat > div.armorclass, .combat > div.initiative, .combat > div.speed {
      width: 32%; height: 90px;
      background: white;
      border: 2px solid var(--border-color);
      border-radius: 10px 10px 30px 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
    }
    .combat label {
      width: 100%; text-align: center; padding: 5px 0;
      border-bottom: 1px solid #ccc; font-size: 9px;
    }
    .combat input { font-size: 32px; font-weight: bold; height: 100%; width: 100%; text-align: center; border: 0;}

    .hp { width: 100%; margin-top: 5px; }
    .hp .regular {
      background: white;
      border: 2px solid var(--border-color);
      border-radius: 15px 15px 5px 5px;
      padding: 5px;
    }
    .hp .regular .max {
      display: flex; justify-content: center; gap: 10px;
      border-bottom: 1px solid #ccc; padding-bottom: 5px;
    }
    .hp .regular .max label { color: #888; border: 0; width: auto;}
    .hp .regular .max input { width: 60px; font-size: 14px; border-bottom: 1px solid #333; height: auto; text-align: center;}
    .hp .regular .current input { font-size: 36px; width: 100%; text-align: center; padding: 10px 0; border: 0;}
    .hp .temporary {
      background: white; border: 2px solid var(--border-color);
      border-top: 0; border-radius: 5px 5px 15px 15px; padding: 5px; margin-top: 2px;
    }
    .hp .temporary input { font-size: 18px; text-align: center; border: 0; width: 100%;}
    
    .hitdice, .deathsaves {
      width: 48% !important;
      height: 80px;
      background: white;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      padding: 5px;
      display: flex !important;
      flex-direction: column;
      justify-content: space-between; 
    }

    .hitdice .total {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 2px;
      margin-bottom: 2px;
    }

    .hitdice .total label {
      background: transparent;
      border: 0;
      width: auto;
      font-size: 8px;
      color: #666;
      white-space: nowrap;
    }

    .hitdice .total input {
      font-size: 12px;
      width: 40px;
      height: auto;
      text-align: center;
      border: 0;
      font-weight: bold;
    }

    .hitdice input[name="remaininghd"] {
      font-size: 20px;
      text-align: CENTER;
      border: 0;
      width: 50%;
      flex: 1;
      font-family: 'Times New Roman', serif;
      margin-top: -20px;
      height: 20px;
      padding: 0;
    }

    .hitdice > div > label {
      border: 0;
      background: transparent;
      font-weight: bold;
      font-size: 10px;
      color: #333;
      width: 100%;
      text-align: center;
      margin-top: 0;
      display: block;
    }

    .deathsaves .label {
      text-align: center;
      font-weight: bold;
      font-size: 10px;
      color: #333;
      margin-bottom: 5px;
      border-bottom: 1px solid #ccc;
      text-transform: uppercase;
    }

    .deathsaves .marks {
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      flex: 1;
    }

    .deathsuccesses, .deathfails {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      padding: 0 2px;
    }

    .deathsuccesses label, .deathfails label {
      text-align: left;
      margin: 0;
      font-size: 8px;
      font-weight: bold;
      color: #666;
      width: auto;
      border: 0;
    }

    .deathsaves .bubbles {
      display: flex;
      gap: 1px;
    }

    .deathsaves input[type=checkbox] {
      -webkit-appearance: none;
      appearance: none;
      width: 12px;
      height: 12px;
      border: 1px solid var(--border-color);
      border-radius: 50%;
      margin: 0;
      cursor: pointer;
    }

    .deathsaves input[type=checkbox]:checked {
      background: var(--ink-color);
      box-shadow: inset 0 0 0 2px white;
    }

    .attacksandspellcasting {
      border: 2px solid var(--border-color);
      border-radius: 10px;
      padding: 10px;
      background: white;
      overflow: hidden;
    }

    .attacksandspellcasting table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .attacksandspellcasting th:nth-child(1) { width: 45%; }
    .attacksandspellcasting th:nth-child(2) { width: 20%; }
    .attacksandspellcasting th:nth-child(3) { width: 35%; }

    .attacksandspellcasting th {
      font-family: var(--font-title);
      font-size: 10px;
      text-align: left;
      color: #666;
      padding: 2px 5px;
    }

    .attacksandspellcasting td {
      padding: 2px;
    }

    .attacksandspellcasting input {
      background: #f5f5f5;
      border: 0;
      padding: 5px;
      margin: 0;
      font-size: 12px;
      width: 100%;
      border-radius: 4px;
      font-family: var(--font-body);
    }

    .attacksandspellcasting textarea {
      border: 0;
      height: 80px;
      margin-top: 5px;
      font-size: 12px;
      padding: 5px;
      background: transparent;
      resize: none;
      font-family: var(--font-body);
    }

    .equipment {
      border: 2px solid var(--border-color);
      border-radius: 10px;
      padding: 10px;
      background: white;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }
    .equipment > div { display: flex; flex-direction: column; height: 100%; }
    
    .equipment .equipment-list { order: 1; flex: 1; width: 100%; }
    .equipment textarea { height: 100%; min-height: 200px; border: 0; resize: none; }
    
    .equipment .money { order: 2; width: 100%; margin-top: 10px; }
    .equipment .money ul { display: flex; justify-content: space-around; border-top: 1px solid #eee; padding-top: 5px; }
    .equipment .money li { display: flex; flex-direction: column; align-items: center; }
    .equipment .money label { border: 0; font-size: 9px; padding: 0; }
    .equipment .money input { width: 35px; border: 1px solid #ccc; border-radius: 10px; padding: 2px; text-align: center; font-size: 12px; }
    
    .equipment > div > label { order: 3; width: 100%; text-align: center; font-weight: bold; margin-top: 5px; border-top: 1px solid #333; padding-top: 5px; }

    .flavor {
      background: var(--bg-dark);
      border-radius: 15px;
      padding: 5px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      border: 1px solid var(--border-color);
    }
    .flavor div { background: white; padding: 8px; display: flex; flex-direction: column-reverse; }
    .flavor div:first-child { border-radius: 10px 10px 0 0; }
    .flavor div:last-child { border-radius: 0 0 10px 10px; }
    .flavor label { text-align: center; font-weight: bold; font-size: 10px; border-top: 1px solid #eee; margin-top: 5px; padding-top: 2px;}
    .flavor textarea { border: 0; height: 60px; font-family: var(--font-body); font-size: 14px; padding: 0;}

    .features {
      border: 2px solid var(--border-color);
      border-radius: 10px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      background: white;
      flex-grow: 1;
    }
    .features div { flex: 1; display: flex; flex-direction: column-reverse; height: 100%; }
    .features label { text-align: center; font-weight: bold; margin-top: 10px; border-top: 2px solid #333; padding-top: 5px; }
    .features textarea { border: 0; flex: 1; height: 100%; resize: none; font-size: 13px; }

  </style>
</head>
<body>

  <form class="charsheet">
    <header>
      <section class="charname">
        <label for="charname">{{ labels.charname_label }}</label>
        <input name="charname" value="{{ charname }}" />
      </section>
      <section class="misc">
        <ul>
          <li><label>{{ labels.classlevel_label }}</label><input name="classlevel" value="{{ classe }}"/></li>
          <li><label>{{ labels.background_label }}</label><input name="background" value="{{ background }}"/></li>
          <li><label>{{ labels.playername_label }}</label><input name="playername" value="{{ playername }}"/></li>
          <li><label>{{ labels.race_label }}</label><input name="race" value="{{ race }}"/></li>
          <li><label>{{ labels.alignment_label }}</label><input name="alignment" value="{{ alinhamento }}"/></li>
          <li><label>{{ labels.experiencepoints_label }}</label><input name="xp" value="{{ xp }}"/></li>
        </ul>
      </section>
    </header>

    <main>
      <section>
        <section class="attributes">
          <div class="scores">
            <ul>
              <li>
                <div class="score"><label>{{ labels.strength_label }}</label><input name="Strengthscore" value="{{ atributo.strength }}"/></div>
                <div class="modifier"><input name="Strengthmod" value="{{ mod.str }}"/></div>
              </li>
              <li>
                <div class="score"><label>{{ labels.dexterity_label }}</label><input name="Dexterityscore" value="{{ atributo.dexterity }}"/></div>
                <div class="modifier"><input name="Dexteritymod" value="{{ mod.dex }}"/></div>
              </li>
              <li>
                <div class="score"><label>{{ labels.constitution_label }}</label><input name="Constitutionscore" value="{{ atributo.constitution }}"/></div>
                <div class="modifier"><input name="Constitutionmod" value="{{ mod.con }}"/></div>
              </li>
              <li>
                <div class="score"><label>{{ labels.intelligence_label }}</label><input name="Intelligencescore" value="{{ atributo.intelligence }}"/></div>
                <div class="modifier"><input name="Intelligencemod" value="{{ mod.int }}"/></div>
              </li>
              <li>
                <div class="score"><label>{{ labels.wisdom_label }}</label><input name="Wisdomscore" value="{{ atributo.wisdom }}"/></div>
                <div class="modifier"><input name="Wisdommod" value="{{ mod.wis }}"/></div>
              </li>
              <li>
                <div class="score"><label>{{ labels.charisma_label }}</label><input name="Charismascore" value="{{ atributo.charisma }}"/></div>
                <div class="modifier"><input name="Charismamod" value="{{ mod.cha }}"/></div>
              </li>
            </ul>
          </div>

          <div class="attr-applications">
            <div class="inspiration box">
              <div class="label-container"><label>{{ labels.inspiration_label }}</label></div>
              <input name="inspiration" type="checkbox" />
            </div>
            <div class="proficiencybonus box">
              <div class="label-container"><label>{{ labels.proficiencybonus_label }}</label></div>
              <input id="profbonus" name="proficiencybonus" value="+{{ proficiencia }}" />
            </div>

            <div class="list-section box">
              <ul>
                {% for save in saves %}
                <li>
                  <input name="{{ save.abbr|title }}-save-prof" type="checkbox" data-atributo="{{ save.abbr|title }}" {% if save.is_prof %}checked{% endif %} />
                  <input name="{{ save.abbr|title }}-save" value="{{ save.mod }}" type="text" data-atributo="{{ save.abbr|title }}" />
                  
                  <label>{{ save.display_abbr }}</label>
                </li>
                {% endfor %}
              </ul>
              <div class="label">{{ labels.savingthrows_label }}</div>
            </div>

            <div class="list-section box">
              <ul>
                <li>
                    <input type="checkbox" data-atributo="Acrobatics" {% if 'Acrobatics' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.dex }}" type="text" data-atributo="Acrobatics"/>
                    <label>{{ labels.Acrobatics }} <span class="skill">({{ labels.abbr_DEX }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Animal Handling" {% if 'Animal Handling' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.wis }}" type="text" data-atributo="Animal Handling"/>
                    <label>{{ labels.AnimalHandling }} <span class="skill">({{ labels.abbr_WIS }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Arcana" {% if 'Arcana' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.int }}" type="text" data-atributo="Arcana"/>
                    <label>{{ labels.Arcana }} <span class="skill">({{ labels.abbr_INT }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Athletics" {% if 'Athletics' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.str }}" type="text" data-atributo="Athletics"/>
                    <label>{{ labels.Athletics }} <span class="skill">({{ labels.abbr_STR }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Deception" {% if 'Deception' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.cha }}" type="text" data-atributo="Deception"/>
                    <label>{{ labels.Deception }} <span class="skill">({{ labels.abbr_CHA }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="History" {% if 'History' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.int }}" type="text" data-atributo="History"/>
                    <label>{{ labels.History }} <span class="skill">({{ labels.abbr_INT }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Insight" {% if 'Insight' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.wis }}" type="text" data-atributo="Insight"/>
                    <label>{{ labels.Insight }} <span class="skill">({{ labels.abbr_WIS }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Intimidation" {% if 'Intimidation' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.cha }}" type="text" data-atributo="Intimidation"/>
                    <label>{{ labels.Intimidation }} <span class="skill">({{ labels.abbr_CHA }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Investigation" {% if 'Investigation' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.int }}" type="text" data-atributo="Investigation"/>
                    <label>{{ labels.Investigation }} <span class="skill">({{ labels.abbr_INT }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Medicine" {% if 'Medicine' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.wis }}" type="text" data-atributo="Medicine"/>
                    <label>{{ labels.Medicine }} <span class="skill">({{ labels.abbr_WIS }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Nature" {% if 'Nature' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.int }}" type="text" data-atributo="Nature"/>
                    <label>{{ labels.Nature }} <span class="skill">({{ labels.abbr_INT }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Perception" {% if 'Perception' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.wis }}" type="text" data-atributo="Perception"/>
                    <label>{{ labels.Perception }} <span class="skill">({{ labels.abbr_WIS }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Performance" {% if 'Performance' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.cha }}" type="text" data-atributo="Performance"/>
                    <label>{{ labels.Performance }} <span class="skill">({{ labels.abbr_CHA }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Persuasion" {% if 'Persuasion' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.cha }}" type="text" data-atributo="Persuasion"/>
                    <label>{{ labels.Persuasion }} <span class="skill">({{ labels.abbr_CHA }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Religion" {% if 'Religion' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.int }}" type="text" data-atributo="Religion"/>
                    <label>{{ labels.Religion }} <span class="skill">({{ labels.abbr_INT }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Sleight of Hand" {% if 'Sleight of Hand' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.dex }}" type="text" data-atributo="Sleight of Hand"/>
                    <label>{{ labels.SleightofHand }} <span class="skill">({{ labels.abbr_DEX }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Stealth" {% if 'Stealth' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.dex }}" type="text" data-atributo="Stealth"/>
                    <label>{{ labels.Stealth }} <span class="skill">({{ labels.abbr_DEX }})</span></label>
                </li>
                <li>
                    <input type="checkbox" data-atributo="Survival" {% if 'Survival' in random_skill_proficiencies %}checked{% endif %} />
                    <input value="{{ mod.wis }}" type="text" data-atributo="Survival"/>
                    <label>{{ labels.Survival }} <span class="skill">({{ labels.abbr_WIS }})</span></label>
                </li>
              </ul>
              <div class="label">{{ labels.skills_label }}</div>
            </div>
          </div>
        </section>

        <div class="passive-perception">
          <div class="label-container" style="border:0; font-weight:bold; font-size:12px;">{{ labels.passiveperception_label }}</div>
          <input id="passive-wisdom" name="passiveperception" placeholder="10" />
        </div>
        
        <div class="otherprofs">
          <label>{{ labels.otherprofs_label }}</label>
          <textarea name="otherprofs">{{ idiomas }}</textarea>
        </div>
      </section>

      <section>
        <section class="combat">
          <div class="armorclass">
            <label>{{ labels.armorclass_label }}</label><input name="ac" value="{{ ca }}" />
          </div>
          <div class="initiative">
            <label>{{ labels.initiative_label }}</label><input name="initiative" value="{{ mod.dex }}" />
          </div>
          <div class="speed">
            <label>{{ labels.speed_label }}</label><input name="speed" value="{{ speed }}" />
          </div>

          <div class="hp">
            <div class="regular">
              <div class="max"><label>{{ labels.maxhp_label }}</label><input name="maxhp" value="{{ hp }}"/></div>
              <div class="current"><label>{{ labels.currenthp_label }}</label><input name="currenthp" value="{{ hp }}"/></div>
            </div>
            <div class="temporary">
              <label>{{ labels.temphp_label }}</label><input name="temphp"/>
            </div>
          </div>

          <div style="width:100%; display:flex; justify-content:space-between;">
            <div class="hitdice">
              <div class="total"><label>{{ labels.totalhd_label }}</label><input name="totalhd" value="{{ total_hd }}" style="border:0;"/></div>
              <div style="text-align:center; height:100%;"><label>{{ labels.remaininghd_label }}</label><input name="remaininghd" value="{{ hit_dice }}"/></div>
            </div>
            <div class="deathsaves">
              <div class="label">{{ labels.death_saves_label }}</div>
              <div class="marks">
                <div class="deathsuccesses"><label>{{ labels.successes_label }}</label><div class="bubbles"><input type="checkbox"/><input type="checkbox"/><input type="checkbox"/></div></div>
                <div class="deathfails"><label>{{ labels.failures_label }}</label><div class="bubbles"><input type="checkbox"/><input type="checkbox"/><input type="checkbox"/></div></div>
              </div>
            </div>
          </div>
        </section>

        <section class="attacksandspellcasting">
          <label style="display:block; text-align:center; font-weight:bold; border-bottom:1px solid #ccc;">{{ labels.attacks_spellcasting_label }}</label>
          <table>
            <thead>
              <tr><th>{{ labels.atkname_label }}</th><th>{{ labels.atkbonus_label }}</th><th>{{ labels.atkdamage_label }}</th></tr>
            </thead>
            <tbody>
              <tr><td><input name="atkname1" value="{{ atkname1 }}"/></td><td><input name="atkbonus1" value="{{ atkbonus1 }}"/></td><td><input name="atkdamage1" value="{{ atkdamage1 }}"/></td></tr>
              <tr><td><input name="atkname2" value="{{ atkname2 }}"/></td><td><input name="atkbonus2" value="{{ atkbonus2 }}"/></td><td><input name="atkdamage2" value="{{ atkdamage2 }}"/></td></tr>
              <tr><td><input name="atkname3" value="{{ atkname3 }}"/></td><td><input name="atkbonus3" value="{{ atkbonus3 }}"/></td><td><input name="atkdamage3" value="{{ atkdamage3 }}"/></td></tr>
            </tbody>
          </table>
          <textarea></textarea>
        </section>

        <section class="equipment">
          <div>
            <div class="equipment-list">
              <textarea name="equipment">{{ formatted_all_equipment }}</textarea>
            </div>
            <div class="money">
              <ul>
                <li><label>{{ labels.cp_label }}</label><input name="cp"/></li>
                <li><label>{{ labels.sp_label }}</label><input name="sp"/></li>
                <li><label>{{ labels.ep_label }}</label><input name="ep"/></li>
                <li><label>{{ labels.gp_label }}</label><input name="gp"/></li>
                <li><label>{{ labels.pp_label }}</label><input name="pp"/></li>
              </ul>
            </div>
            <label>{{ labels.equipment_label }}</label>
          </div>
        </section>
      </section>

      <section>
        <section class="flavor">
          <div class="personality"><label>{{ labels.personality_label }}</label><textarea name="personality">{{ personality_traits }}</textarea></div>
          <div class="ideals"><label>{{ labels.ideals_label }}</label><textarea name="ideals">{{ ideals }}</textarea></div>
          <div class="bonds"><label>{{ labels.bonds_label }}</label><textarea name="bonds">{{ bonds }}</textarea></div>
          <div class="flaws"><label>{{ labels.flaws_label }}</label><textarea name="flaws">{{ flaws }}</textarea></div>
        </section>
        
        <section class="features">
          <div>
            <label>{{ labels.features_traits_label }}</label>
            <textarea name="features"></textarea>
          </div>
        </section>
      </section>
    </main>
  </form>

<script>
// O SCRIPT PERMANECE EXATAMENTE O MESMO.
// Ele depende dos "name" e "data-atributo" que mantivemos em inglÃªs.
document.addEventListener('DOMContentLoaded', () => {
  const ABILITY_MAP = {
    'Strength':     ['Athletics', 'Str'], 
    'Dexterity':    ['Acrobatics', 'Sleight of Hand', 'Stealth', 'Dex'],
    'Constitution': ['Con'],
    'Intelligence': ['Arcana', 'History', 'Investigation', 'Nature', 'Religion', 'Int'],
    'Wisdom':       ['Animal Handling', 'Insight', 'Medicine', 'Perception', 'Survival', 'Wis'],
    'Charisma':     ['Deception', 'Intimidation', 'Performance', 'Persuasion', 'Cha']
  };

  function formatMod(val) {
    return (val >= 0 ? '+' : '') + val;
  }

  function calculateModifier(score) {
    return Math.floor((score - 10) / 2);
  }

  function getProficiencyBonus() {
    const input = document.getElementById('profbonus');
    return input ? (parseInt(input.value.replace('+', '')) || 0) : 0;
  }

  function updateItem(itemName, attributeName) {
    const checkbox = document.querySelector(`input[type="checkbox"][data-atributo="${itemName}"]`);
    const numberInput = document.querySelector(`input[type="text"][data-atributo="${itemName}"]`);

    const modInput = document.querySelector(`input[name="${attributeName}mod"]`);

    if (checkbox && numberInput && modInput) {
      const currentMod = parseInt(modInput.value.replace('+', '')) || 0;
      
      const profBonus = getProficiencyBonus();

      let total = currentMod;
      if (checkbox.checked) {
        total += profBonus;
      }

      numberInput.value = formatMod(total);

      if (itemName === 'Perception') {
        updatePassivePerception();
      }
    }
  }

  function updateAllItems() {
    for (const [attrName, items] of Object.entries(ABILITY_MAP)) {
      items.forEach(item => {
        updateItem(item, attrName);
      });
    }
  }


  const profInput = document.getElementById('profbonus');
  if (profInput) {
    profInput.addEventListener('input', updateAllItems);
    profInput.addEventListener('change', updateAllItems);
  }

  const scoreInputs = document.querySelectorAll('input[name$="score"]');
  scoreInputs.forEach(input => {
    const onScoreChange = function() {
      const score = parseInt(input.value) || 10;
      const newMod = calculateModifier(score);
      const formattedMod = formatMod(newMod);

      const attrBaseName = input.name.replace('score', ''); 
      
      const modInput = document.querySelector(`input[name="${attrBaseName}mod"]`);
      if (modInput) {
        modInput.value = formattedMod;
      }

      const childItems = ABILITY_MAP[attrBaseName];
      if (childItems) {
        childItems.forEach(item => updateItem(item, attrBaseName));
      }
      
      if (attrBaseName === 'Wisdom') updatePassivePerception();
    };

    input.addEventListener('input', onScoreChange);
    input.addEventListener('change', onScoreChange);
  });

  const itemCheckboxes = document.querySelectorAll('input[type="checkbox"][data-atributo]');
  itemCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      const itemName = this.dataset.atributo;
      
      let parentAttr = '';
      for (const [attr, items] of Object.entries(ABILITY_MAP)) {
        if (items.includes(itemName)) {
          parentAttr = attr;
          break;
        }
      }
      
      if (parentAttr) {
        updateItem(itemName, parentAttr);
      }
    });
  });

  const passiveWisInput = document.getElementById('passive-wisdom');
  
  function updatePassivePerception() {
    if (!passiveWisInput) return;

    const perceptionInput = document.querySelector('input[data-atributo="Perception"][type="text"]');
    let finalMod = 0;

    if (perceptionInput) {
      finalMod = parseInt(perceptionInput.value.replace('+', '')) || 0;
    } else {
      const wisModInput = document.querySelector('input[name="Wisdommod"]');
      finalMod = wisModInput ? (parseInt(wisModInput.value.replace('+', '')) || 0) : 0;
    }

    passiveWisInput.value = 10 + finalMod;
  }
  
  updateAllItems();
  updatePassivePerception();

});
</script>
</body>
</html>