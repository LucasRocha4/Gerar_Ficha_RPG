<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Novo Contrato - FichaDnD</title>
  
  <!-- Bibliotecas -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  
  <!-- Fontes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Mate+SC&family=Crimson+Pro:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root {
      --gold-primary: #d4af37;
      --gold-dim: #8a7326;
      --bg-dark: #0a0a0c;
      --panel-bg: rgba(20, 20, 25, 0.95);
      --crimson: #8a0303;
      --crimson-light: #b91212;
      --text-main: #e0d8c3;
  }

  body { 
    background-color: var(--bg-dark);
    background-image: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #000000 100%);
    color: var(--text-main); 
    font-family: 'Crimson Pro', serif;
    min-height: 100vh;
  }

  /* Fontes TemÃ¡ticas */
  h1, h2, label, button, .form-label { font-family: 'Cinzel', serif; }
  .subtitle { font-family: 'Mate SC', serif; }

  /* Container Principal - O GrimÃ³rio */
  .arcane-border {
    background-color: var(--panel-bg);
    border: 2px solid var(--gold-dim);
    box-shadow: 
        0 0 15px rgba(0,0,0,0.8),
        inset 0 0 50px rgba(0,0,0,0.8),
        0 0 10px rgba(212, 175, 55, 0.2);
    border-radius: 4px;
    position: relative;
    clip-path: polygon(
      0 0, 100% 0, 100% 100%, 0 100%, 
      0 15px, 15px 0 
    );
  }

  /* Detalhes Dourados */
  .corner-decoration {
    position: absolute;
    width: 20px; height: 20px;
    border: 2px solid var(--gold-primary);
    transition: all 0.5s ease;
    pointer-events: none;
  }
  .top-right { top: 10px; right: 10px; border-left: none; border-bottom: none; }
  .bottom-left { bottom: 10px; left: 10px; border-right: none; border-top: none; }

  /* Inputs MÃ¡gicos & Bootstrap Overrides */
  .form-control, .form-select {
    font-family: 'Crimson Pro', serif;
    background-color: #050505 !important;
    border: 1px solid #333 !important;
    border-bottom: 2px solid var(--gold-dim) !important;
    color: var(--gold-primary) !important;
    border-radius: 0 !important;
    font-size: 1.1rem;
  }
  
  .form-control:focus, .form-control[readonly]:focus {
    background-color: #0f0f12 !important;
    border-color: #333 !important;
    border-bottom-color: var(--gold-primary) !important;
    box-shadow: 0 5px 15px -10px rgba(212, 175, 55, 0.5) !important;
    color: var(--gold-primary) !important;
  }

  .form-control[readonly] {
    background-color: #0a0a0c !important;
    cursor: pointer;
  }

  .form-label {
    color: var(--gold-dim);
    letter-spacing: 1px;
    font-size: 0.8rem;
    font-weight: bold;
    text-transform: uppercase;
    margin-bottom: 0.2rem;
  }

  /* Dropdown Menu Dark */
  .dropdown-menu {
    background-color: #1a1a1a;
    border: 1px solid var(--gold-dim);
  }
  .dropdown-item {
    color: var(--text-main);
    font-family: 'Crimson Pro', serif;
  }
  .dropdown-item:hover {
    background-color: var(--gold-dim);
    color: #000;
  }

  /* BotÃµes Dropdown */
  .btn-primary.dropdown-toggle, .btn-secondary.dropdown-toggle {
    background-color: var(--gold-dim);
    border-color: var(--gold-dim);
    border-radius: 0;
    color: #000;
  }
  .btn-primary.dropdown-toggle:hover, .btn-secondary.dropdown-toggle:hover {
    background-color: var(--gold-primary);
    border-color: var(--gold-primary);
    color: #000;
  }

  /* BotÃ£o Principal (Salvar) */
  .btn-arcane {
    background: linear-gradient(180deg, var(--crimson) 0%, #520000 100%);
    border: 1px solid #ff4444;
    color: #ffd700;
    text-transform: uppercase;
    letter-spacing: 2px;
    font-weight: bold;
    padding: 12px;
    position: relative;
    transition: all 0.3s ease;
    width: 100%;
    opacity: 0; 
    pointer-events: none;
    transform: translateY(10px);
  }
  
  .btn-arcane.show {
    opacity: 1;
    pointer-events: all;
    transform: translateY(0);
  }

  .btn-arcane:hover {
    background: linear-gradient(180deg, var(--crimson-light) 0%, #7a0000 100%);
    box-shadow: 0 0 15px var(--crimson);
    color: #fff;
  }

  /* BotÃ£o MÃ¡gico (Auto Fill) */
  .btn-magic {
    background: transparent;
    border: 1px solid var(--gold-dim);
    color: var(--gold-dim);
    font-size: 0.8rem;
    padding: 8px 16px;
    transition: all 0.3s;
  }
  .btn-magic:hover {
    border-color: var(--gold-primary);
    color: var(--gold-primary);
    box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
  }

  /* AnimaÃ§Ãµes */
  .fade-in { animation: fadeIn 0.8s ease-out; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  
  .input-group > .form-control { flex: 1; width: auto; }
</style>
</head>
<body>
  {% include "components/navbar.html" %}
  
  <div class="min-h-screen flex items-center justify-center p-4 fade-in" style="margin-top: 1px;">
    <div class="max-w-2xl w-full p-8 arcane-border relative z-10">
      
      <div class="corner-decoration top-right"></div>
      <div class="corner-decoration bottom-left"></div>

      <div class="text-center mb-8 border-b border-[#333] pb-4">
        <h1 class="text-3xl font-bold text-[#d4af37] mb-2 tracking-widest drop-shadow-md">
          [ NOVO CONTRATO ]
        </h1>
        <p class="subtitle text-[#888] text-lg">
          Defina os termos da sua existÃªncia.
        </p>
      </div>

      <form id="charForm" method="post" action="{% url 'criando' %}" class="space-y-5">
        {% csrf_token %}

        <div class="row g-4">
          <div class="col-md-8">
            <label for="nome" class="form-label">Nome do Personagem</label>
            <input type="text" id="nome" name="charname" class="form-control" placeholder="Ex: Valeros" maxlength="50">
          </div>
          
          <div class="col-md-4">
            <label for="nivel" class="form-label">NÃ­vel (1-20)</label>
            <input type="number" id="nivel" name="classlevel" class="form-control" placeholder="1" min="1" max="20">
          </div>
        </div>

        <div>
            <label for="playername" class="form-label">Nome do Jogador</label>
            <input type="text" id="playername" name="playername" class="form-control" placeholder="Seu nome real" maxlength="50" value="{{ user.username }}">
        </div>

        <div class="row g-4">
          <div class="col-md-6">
            <label class="form-label">RaÃ§a</label>
            <div class="input-group">
              <input type="text" id="selectedRace" class="form-control" readonly placeholder="Selecionar...">
              <input type="hidden" id="inputRace" name="race">
              <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown"></button>
              <ul id="race-menu" class="dropdown-menu dropdown-menu-end"></ul>
            </div>
          </div>

          <div class="col-md-6" id="subrace-container" style="display:none; opacity: 0; transition: opacity 0.5s;">
            <label class="form-label">Sub-raÃ§a</label>
            <div class="input-group">
              <input type="text" id="selectedSubrace" class="form-control" readonly placeholder="Selecionar...">
              <input type="hidden" id="inputSubrace" name="subrace">
              <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown"></button>
              <ul id="subrace-menu" class="dropdown-menu dropdown-menu-end"></ul>
            </div>
          </div>
        </div>

        <div class="row g-4">
          <div class="col-md-6">
            <label class="form-label">Classe</label>
            <div class="input-group">
              <input type="text" id="selectedClass" class="form-control" readonly placeholder="Selecionar...">
              <input type="hidden" id="inputClass" name="classe">
              <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown"></button>
              <ul id="class-menu" class="dropdown-menu dropdown-menu-end"></ul>
            </div>
          </div>

          <div class="col-md-6" id="subclass-container" style="display:none; opacity: 0; transition: opacity 0.5s;">
            <label class="form-label">ArquÃ©tipo</label>
            <div class="input-group">
              <input type="text" id="selectedSubclass" class="form-control" readonly placeholder="Selecionar...">
              <input type="hidden" id="inputSubclass" name="subclasse">
              <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown"></button>
              <ul id="subclass-menu" class="dropdown-menu dropdown-menu-end"></ul>
            </div>
          </div>
        </div>

        <div>
          <label class="form-label">Antecedente</label>
          <div class="input-group">
            <input type="text" id="selectedBackground" class="form-control" readonly placeholder="Selecionar histÃ³ria de origem...">
            <input type="hidden" id="inputBackground" name="antecedente">
            <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown"></button>
            <ul id="background-menu" class="dropdown-menu dropdown-menu-end w-100"></ul>
          </div>
        </div>

        <div class="d-flex flex-column align-items-center gap-3 mt-5">
          <button id="btnSubmit" type="submit" class="btn-arcane rounded-sm">
            Forjar Destino
          </button>
          
          <button id="btnFill" type="button" class="btn-magic rounded-sm uppercase tracking-widest text-xs">
            ðŸŽ² Invocar Aleatoriamente
          </button>
        </div>

      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const backgrounds = {
      acolyte: "AcÃ³lito", charlatan: "CharlatÃ£o", criminal: "Criminoso", entertainer: "Artista",
      "folk-hero": "HerÃ³i do Povo", "guild-artisan": "ArtesÃ£o de Guilda", hermit: "ErmitÃ£o",
      noble: "Nobre", outlander: "Forasteiro", sage: "SÃ¡bio", sailor: "Marinheiro",
      soldier: "Soldado", urchin: "Ã“rfÃ£o"
    };

    const racas = {
      dragonborn: "Draconato", dwarf: "AnÃ£o", elf: "Elfo", gnome: "Gnomo",
      "half-elf": "Meio-Elfo", "half-orc": "Meio-Orc", halfling: "Halfling",
      human: "Humano", tiefling: "Tiefling"
    };

    const subracasByRace = {
      dwarf: { "hill-dwarf": "Colina", "mountain-dwarf": "Montanha" },
      elf: { "high-elf": "Alto Elfo", "wood-elf": "Floresta", drow: "Elfo Negro" },
      gnome: { "forest-gnome": "Floresta", "rock-gnome": "Rocha" },
      halfling: { lightfoot: "PÃ©-Leve", stout: "Robusto" }
    };

    const classes = {
      barbarian: "BÃ¡rbaro", bard: "Bardo", cleric: "ClÃ©rigo", druid: "Druida",
      fighter: "Guerreiro", monk: "Monge", paladin: "Paladino", ranger: "Patrulheiro",
      rogue: "Ladino", sorcerer: "Feiticeiro", warlock: "Bruxo", wizard: "Mago"
    };

    const subclassesByClass = {
      barbarian: { berserker: "Berserker", "totem-warrior": "Totem Guerreiro" },
      bard: { lore: "Saber", valor: "Valor" },
      cleric: { life: "Vida", light: "Luz", trickery: "TrapaÃ§a" },
      druid: { land: "Terra", moon: "Lua" },
      fighter: { champion: "CampeÃ£o", battlemaster: "Mestre Batalha", "eldritch-knight":"Cavaleiro Arcano" },
      monk: { "open-hand": "MÃ£o Aberta", shadow: "Sombras", "four-elements": "Quatro Elementos" },
      paladin: { devotion: "DevoÃ§Ã£o", ancients: "Ancestrais", vengeance: "VinganÃ§a" },
      ranger: { hunter: "CaÃ§ador", "beast-master":"Mestre Feras" },
      rogue: { thief: "LadrÃ£o", assassin: "Assassino", arcane: "Trapaceiro Arcano" },
      sorcerer: { draconic: "DracÃ´nica", "wild-magic":"Magia Selvagem" },
      warlock: { fiend: "Flagelo", fey: "Fada", "great-old-one":"Grande Antigo" },
      wizard: { abjuration: "AbjuraÃ§Ã£o", conjuration: "ConjuraÃ§Ã£o", divination: "AdivinhaÃ§Ã£o", enchantment: "Encantamento", evocation: "EvocaÃ§Ã£o", illusion: "IlusÃ£o", necromancy: "Necromancia", transmutation: "TransmutaÃ§Ã£o" }
    };

    function montarDropdown(id, map, fn) {
      const menu = document.getElementById(id);
      menu.innerHTML = '';
      Object.entries(map).forEach(([k, label]) => {
        const li = document.createElement('li');
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'dropdown-item';
        btn.textContent = label;
        btn.addEventListener('click', () => window[fn](k));
        li.appendChild(btn);
        menu.appendChild(li);
      });
    }

    function checkSelections() {
      const lvl = document.getElementById('nivel').value;
      const r   = document.getElementById('inputRace').value;
      const sr  = document.getElementById('inputSubrace').value;
      const c   = document.getElementById('inputClass').value;
      const sc  = document.getElementById('inputSubclass').value;
      const bg  = document.getElementById('inputBackground').value;
      const name = document.getElementById('nome').value; 
      const needSR = !!subracasByRace[r];
      const needSC = !!subclassesByClass[c];
      const ok = name && lvl && r && c && bg && (!needSR || sr) && (!needSC || sc);
      
      const btn = document.getElementById('btnSubmit');
      if (ok) {
        btn.classList.add('show');
      } else {
        btn.classList.remove('show');
      }
    }

    function selecionarRaca(r) {
      document.getElementById('selectedRace').value = racas[r];
      document.getElementById('inputRace').value    = r;
      
      const subContainer = document.getElementById('subrace-container');
      const inputSub = document.getElementById('inputSubrace');
      const selectedSub = document.getElementById('selectedSubrace');
      
      inputSub.value = '';
      selectedSub.value = '';

      if (subracasByRace[r]) {
        montarDropdown('subrace-menu', subracasByRace[r], 'selecionarSubraca');
        subContainer.style.display = 'block';
        setTimeout(() => subContainer.style.opacity = 1, 10);
      } else {
        subContainer.style.opacity = 0;
        setTimeout(() => subContainer.style.display = 'none', 500);
      }
      checkSelections();
    }

    function selecionarSubraca(sr) {
      const r = document.getElementById('inputRace').value;
      document.getElementById('selectedSubrace').value = subracasByRace[r][sr];
      document.getElementById('inputSubrace').value    = sr;
      checkSelections();
    }

    function selecionarClasse(c) {
      document.getElementById('selectedClass').value = classes[c];
      document.getElementById('inputClass').value    = c;
      
      const subContainer = document.getElementById('subclass-container');
      const inputSub = document.getElementById('inputSubclass');
      const selectedSub = document.getElementById('selectedSubclass');

      inputSub.value = '';
      selectedSub.value = '';

      if (subclassesByClass[c]) {
        montarDropdown('subclass-menu', subclassesByClass[c], 'selecionarSubclasse');
        subContainer.style.display = 'block';
        setTimeout(() => subContainer.style.opacity = 1, 10);
      } else {
        subContainer.style.opacity = 0;
        setTimeout(() => subContainer.style.display = 'none', 500);
      }
      checkSelections();
    }

    function selecionarSubclasse(ss) {
      const c = document.getElementById('inputClass').value;
      document.getElementById('selectedSubclass').value = subclassesByClass[c][ss];
      document.getElementById('inputSubclass').value    = ss;
      checkSelections();
    }

    function selecionarBackground(bg) {
      document.getElementById('selectedBackground').value = backgrounds[bg];
      document.getElementById('inputBackground').value    = bg;
      checkSelections();
    }

    function getRandomKey(obj) {
      const keys = Object.keys(obj);
      return keys[Math.floor(Math.random() * keys.length)];
    }

    const randomNames = ["Aragorn", "Gandalf", "Legolas", "Gimli", "Frodo", "Conan", "Xena", "Merlin", "Arthur", "Zelda"];

    document.addEventListener('DOMContentLoaded', () => {
      montarDropdown('race-menu', racas, 'selecionarRaca');
      montarDropdown('class-menu', classes, 'selecionarClasse');
      montarDropdown('background-menu', backgrounds, 'selecionarBackground');
      
      document.getElementById('nivel').addEventListener('input', checkSelections);
      document.getElementById('nome').addEventListener('input', checkSelections);
      
      document.querySelector('form').addEventListener('keydown', e => {
        if (e.key === 'Enter') e.preventDefault();
      });

      const fillBtn = document.getElementById('btnFill');
      fillBtn.addEventListener('click', () => {
        document.getElementById('nome').value = randomNames[Math.floor(Math.random() * randomNames.length)];
        document.getElementById('nivel').value = Math.floor(Math.random() * 5) + 1;

        const rKey = getRandomKey(racas);
        selecionarRaca(rKey);

        if (subracasByRace[rKey]) {
          const srKey = getRandomKey(subracasByRace[rKey]);
          selecionarSubraca(srKey);
        }

        const cKey = getRandomKey(classes);
        selecionarClasse(cKey);

        if (subclassesByClass[cKey]) {
          const scKey = getRandomKey(subclassesByClass[cKey]);
          selecionarSubclasse(scKey);
        }

        const bgKey = getRandomKey(backgrounds);
        selecionarBackground(bgKey);
        checkSelections();
      });
    });
  </script>
</body>
</html>